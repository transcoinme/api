# api-examples
Описание апи мерчанта-транскоина

1) Метод process предоставляет интерфейс для обмена криптовалюты. Апи ожидает входящие данные в формате json. 
Метод process позволяет создавать запросы на обмен криптовалюты и создание транзакций. 
Тип транзакции определяется параметром type (тип string), который может принимать следующие 
значения: 'merchant' -  создание запроса на оплату криптовалютой; 'exchange' - создание 
запроса на покупку криптовалюты. Другие входные данные зависят от типа запроса. 

Параметры для запроса type='merchant':
| № | Имя             | Тип    | Описание                                           |   |
|---|-----------------|--------|----------------------------------------------------|---|
| 1 | project_id      | int    | Идентификатор проекта в нашей системе              |   |
| 2 | amount          | float  | Сумма для запроса                                  |   |
| 3 | currency        | string | Сокращенное наименование валюты                    |   |
| 4 | crypto_currency | string | Сокращенное наименование крипто валюты             |   |
| 5 | order_number    | int    | Номер заказа в вашем магазине (должен быть         |   |
|   |                 |        | уникальным для конкретного проекта)                |   |
| 6 | description     | string | Описание платежа                                   |   |
| 7 | date            | date   | Дата заказа в формате date('d-m-Y H:i:s')          |   |

Метод возвращает ответ также в формате json. Описание ответа при успешном исходе:
| № | Имя          | Тип    | Описание                                              |   |
|---|--------------|--------|-------------------------------------------------------|---|
| 1 | result       | bool   | Принимает true в случае успешного выполнения запроса. |   |
| 2 | id           | int    | Идентификатор транзакции в нашей системе              |   |
| 3 | wallet       | string | Криптокошелек                                         |   |
| 4 | amount       | float  | Сумма в криптовалюте                                  |   |
| 5 | currency     | int    | Идентификатор криптовалюты в нашей системе            |   |
| 6 | fee          | float  | Сумма комиссии (в криптовалюте)                       |   |
| 7 | qrcode_url   | string | Адрес QR-кода                                         |   |
| 8 | checkout_url | string | Адрес оплаты                                          |   |
| 9 | test         | bool   | Признак тестового заказа. Если true - заказ тестовый. |   |

Описание ответа в случае отрицательного результата:
| № | Имя     | Тип    | Описание                                                    |   |
|---|---------|--------|-------------------------------------------------------------|---|
| 1 | result  | bool   | Принимает false если в процессе выполнения возникли ошибки. |   |
| 2 | error   | int    | Код ошибки (необязательный)                                 |   |
| 3 | message | string | Сообщение об ошибке                                         |   |

Параметры для запроса type='exchange':
| № | Имя        | Тип    | Описание                                                        |   |
|---|------------|--------|-----------------------------------------------------------------|---|
| 1 | partner_id | int    | Идентификатор партнера в нашей системе (обязательный параметр)  |   |
| 2 | wallet     | string | Криптокошелек, на который перевести криптовалюту                |   |
| 3 | email      | string | Электронный адрес клиента                                       |   |
| 4 | method     | int    | Идентификатор метода оплаты в нашей системе                     |   |
| 5 | from       | int    | Идентификатор валюты в нашей системе                            |   |
| 6 | to         | int    | Идентификатор крипто валюты в нашей системе                     |   |
| 7 | amount     | float  | Сумма транзакции (в евро или долларах)                          |   |
| 8 | order_url  | string | Ссылка на страницу запроса (необязательный)                     |   |

Метод возвращает ответ также в формате json. Описание ответа при успешном исходе:
| № | Имя         | Тип    | Описание                                              |   |
|---|-------------|--------|-------------------------------------------------------|---|
| 1 | result      | bool   | Принимает true в случае успешного выполнения запроса. |   |
| 2 | request_url | string | URL адрес  запроса                                    |   |

Описание ответа в случае отрицательного результата:
| № | Имя     | Тип    | Описание                                                     |   |
|---|---------|--------|--------------------------------------------------------------|---|
| 1 | result  | bool   | Принимает false, если в процессе выполнения возникли ошибки. |   |
| 2 | error   | int    | Код ошибки (необязательный)                                  |   |
| 3 | message | string | Сообщение об ошибке                                          |   |

Пример запроса
curl 'http://merchant.transcoin.me/api/process/' \
  -H 'Content-Type: application/json' \
  --data {
	"type":"exchange",
	"method":"2",
	"amount":"100",
	"from":"2",
	"wallet":"15DQ4VCLvidYRsPjVKwxgntFrta16Kgikv",
	"to":"3",
	"email":"your_email@gmail.com",
	"partner_id":"10050",
	”order_url":"http:\/\/my.merchant.transcoin.me\/ru\/transactions\/exchange\/10050\/"} \ 
Пример ответа: 
{ “request_url”: "http://merchant.transcoin.me/ru/transactions/exchange/ 10050/TdlBamvbRqMHjgJh/",“result”: “true” }

2) Метод getCalcData - предоставляет данные для предварительного расчета транзакции (сумм платежа и комиссий). 
Данный метод не требует входящих данных, а в ответ возвращает строку в формате json.
Описание ответа:
| № | Имя                  | Тип   | Описание                                                                              |   |
|---|----------------------|-------|---------------------------------------------------------------------------------------|---|
| 1 | result               | bool  | Всегда true.                                                           			   |   |
| 2 | buy_payment_methods  | array | Массив с данными методов оплаты.                                                      |   |
|   |                      |       | Массив имеет следующую структуру элемента:                                            |   |
|   |                      |       | id - идентификатор метода в нашей системе; name - наименование метода;                |   |
|   |                      |       | com - сумма комиссии метода;                                                          |   |
|   |                      |       | our_com - сумма комиссии за транзакцию;                                               |   |
|   |                      |       | img - иконка метода оплаты;                                                           |   |
|   |                      |       | min - минимальная сумма транзакции;                                                   |   |
|   |                      |       | lim - максимальная сумма транзакции;                                                  |   |
|   |                      |       | enable_mes - разрешен ли метод;                                                       |   |
|   |                      |       | lim_day - ограничение сумм платежей в день;                                           |   |
|   |                      |       | lim_month - ограничение сумм платежей в месяц;                                        |   |
|   |                      |       | lim_count - ограничение транзакций  в день;                                           |   |
| 3 | sell_payment_methods | array | Полностью аналогичен buy_payment_methods                                              |   |
| 4 | valuts               | array | Массив валют. Массив имеет следующую структуру элемента:                              |   |
|   |                      |       | id - идентификатор в нашей системеname - наименование валюты;                         |   |
|   |                      |       | com - комиссия валюты;                                                                |   |
|   |                      |       | img - иконка валюты; number_format - количество цифр после запятой;                   |   |
|   |                      |       | reserv - доступное количество;                                                        |   |
| 5 | crypto_valuts        | array | Массив криптовалют. Структура аналогична структуре  valuts                            |   |

Пример запроса getCalcData 
curl 'http://merchant.transcoin.me/api/process/getCalcData' \
  -H 'Content-Type: application/json' \

Пример ответа:
{"result":true,
"current_step":"start_page",
"message":""
,"data":{
	"buy_payment_methods":[{"id":"2","name":"Bank Card", "com":"3.55", "our_com":"2" ,"img":"mastercard-64_(1).png","min":"50",
		"lim":"3000","enable_mes":"1","lim_day": "25000","lim_month":"50000", "lim_count":"10"}, 
		{"id":"21","name":"Skrill","com":"1.76","our_com":"3.5","img":t_skrill-9706.png","min":"50", "lim":"3000",
		"enable_mes":"1","lim_day":"20000","lim_month":"50000","lim_count":"10"}, 
		{"id":"12","name":"Bank transfer (SEPA)","com":"0","our_com":"2.95" ,"img":"u0430-40.png","min":"100","lim":"60000",
		"enable_mes":"1","lim_day":"60000", "lim_month":"200000","lim_count":"20"}, 
		{"id":"24","name":"Netteler","com":"3.52","our_com":"3.2","img":"320x0w.jpg","min":"50", "lim":"10000",
		"enable_mes":"0","lim_day":"2000","lim_month":"50000","lim_count":"10"}, 
		{"id":"11","name":"Advcash","com":"0","our_com":"4.95","img":"advcash1.png","min":"50", "lim":"3000","enable_mes":"1",
		"lim_day":"10000","lim_month":"20000","lim_count":"10"}],
	"sell_payment_methods":[{"id":"23","name":"Bank Card","com":"2.5","our_com":"1.25","img":mastercard-64_(1)1.png",
		"min":"50", "lim":"2500","enable_mes":"0","lim_day":"4800","lim_month":"20000","lim_count":"5"}, 
		{"id":"1","name":"Bank transfer(SEPA)","com":"0","our_com":"3" ,"img":"u0430-401.png", "min":"50","lim":"20000",
		"enable_mes":"1","lim_day":"30000","lim_month":"80000", "lim_count":"40"}, 
		{"id":"25","name":"Skrill","com":"1","our_com":"1.86","img":"t_skrill-9706_(1).png", "min":"50","lim":"10000",
		"enable_mes":"1","lim_day":"20000","lim_month":"50000", "lim_count":"10"}, 
		{"id":"28","name":"Netteler","com":"3.85","our_com":"2","img":"320x0w1.jpg","min":"50", "lim":"8000","enable_mes":"1",
		"lim_day":"8000","lim_month":"25000","lim_count":"15"}, 
		{"id":"10","name":"Advcash","com":"0","our_com":"1.95","img":advcash.png","min":"100", "lim":"10000","enable_mes":"1",
		"lim_day":"2000","lim_month":"50000","lim_count":"10"}], 
	"valuts":[{"id":"1","name":"USD","com":"0","img":"b9.png","number_format":"2", "reserv":"100"}, 
		{"id":"2","name":"EUR","com":"0","img":"87db.png","number_format":"2" ,"reserv":"100000"}], 
	"crypto_valuts":[{"id":"3","name":"BTC","com":"0.001","img":"4.png","number_format":"5", "reserv":"74.810473486663"},
		{"id":"4","name":"ETH","com":"0.006","img":"200.png","number_format":"4", "reserv":"184.32042249058"}, 
		{"id":"5","name":"LTC","com":"0.002","img":"1711.png","number_format":"4", "reserv":"1198.9792968198"}, 
		{"id":"6","name":"XRP","com":"0.03","img":"ripplelabs_logo.png","number_format":"5", "reserv":"209654.50353143"}], 
	"comissions":{"sum_res_nocom":0,"sum":0,"sum_res":0,"pay_methods_com":"3.55", "our_com":"2","valut_com":0.0001,
		"metod_name":"Bank Card", "reserv":"74.81BTC","minmax":"50 - 3000","min":"50","max":"3000"}}}

3) Метод getCalcComissions позволяет рассчитать комиссии транзакции. Метод ожидает в качестве 
параметров строку json со следующими полями:
| № | Имя    | Тип   | Описание                                   |   |
|---|--------|-------|--------------------------------------------|---|
| 1 | from   | int   | идентификатор валюты в нашей системе       |   |
| 2 | to     | int   | идентификатор криптовалюты в нашей системе |   |
| 3 | method | int   | идентификатор метода в нашей системе       |   |
| 4 | amount | float | Сумма транзакции (может быть нулевой)      |   |

Метод возвращает ответ в формате json следующего вида:
| № | Имя    | Тип   | Описание                                                                             |   |
|---|--------|-------|--------------------------------------------------------------------------------------|---|
| 1 | result | bool  | true                                                                                 |   |
| 3 | data   | array | Массив с данными расчета комиссии. Массив имеет следующую структуру:                 |   |
|   |        |       | sum_res_nocom - сумма в криптовалюте без учета комиссии;                             |   |
|   |        |       | sum - сумма комиссии;sum_res - итоговая сумма в криптовалюте;                        |   |
|   |        |       | pay_methods_com - комиссия метода оплаты(%);                                         |   |
|   |        |       | our_com - комиссия за транзакцию;                                                    |   |
|   |        |       | valut_com - комиссия за конвертацию;                                                 |   |
|   |        |       | metod_name - наименование метода оплаты;                                             |   |
|   |        |       | minmax - строка лимитов в виде “<минимальное значение> - <максимальное значение>”;   |   |
|   |        |       | min - минимальная сумма транзакции;                                                  |   |
|   |        |       | max - максимальная сумма транзакции;                                                 |   |
|   |        |       | reserv - резерв криптовалюты, имеющейся в наличии.                                   |   |
   
В случае отрицательного результата метод вернет ответ со следующей структурой:
| № | Имя     | Тип    | Описание                                                     |   |
|---|---------|--------|--------------------------------------------------------------|---|
| 1 | result  | bool   | Принимает false, если в процессе выполнения возникли ошибки. |   |
| 2 | error   | int    | Код ошибки (необязательный)                                  |   |
| 3 | message | string | Сообщение об ошибке                                          |   |

Пример запроса 
curl 'http://merchant.transcoin.me/api/process/calcBuyComissions/' \
  -H 'Content-Type: application/json' \
  --data {"from":"2","to":"3","method":"21","amount":"200"}\

Пример ответа 
{ 	"result":true,
	"data":{
		"max":"3000",
		"metod_name":"Skrill",
		"min":"50",
		"minmax":"50 - 3000",
		"our_com":"3.5",
		"pay_methods_com":"1.76",
		"reserv":"74.81 BTC",
		"sum":473.69999999999993,
		"sum_res":"0.07431916",
		"sum_res_nocom":0.07441915846815432,
		"valut_com":0.0001
	} 
}































